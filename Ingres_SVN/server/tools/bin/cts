#!/bin/bash
#
# Copyright (c) 2004 Ingres Corporation
#
#
# This is the "cts" command issued by the CTS SEP tests.
# It starts up the CTS coordinator and slaves and waits till they're done.
#
# $1 is database name
# $2 is test number (from test_num table)
# $3 is number of slaves
# $4 is the SEP test id (passed by SEP but not used in Unix)

# the trace flag should always be 0 for this "cts" command.
#
trace_flag=0

# All result files are suffixed ".res".
# Old .res files are removed before the CTS programs start.
# The .res files produced by this test are left so SEP can diff them.

# The Coordinator outputs a file called ctscoord.res. 
#
coordfile=$TST_OUTPUT/output/$4_c

# The Slave executable outputs files called ctsslv1.res, ctsslv2.res, and
# so forth. 
#
slavefile=$TST_OUTPUT/output/$4_

rm -f $coordfile.res
ctscoord $1 $2 $3 $trace_flag > $coordfile.res &
echo " "
echo "Started CTS coordinator"

count=`expr 1` 
until test $count -gt $3
do
   rm -f $slavefile_$count.res
   ctsslave $1 $2 $count $trace_flag > $slavefile$count.res &
   echo " "
   echo "Started CTS slave number $count"
   count=`expr $count + 1`
done
 
echo " "
echo "All CTS slaves are running"
wait

echo " "
echo "CTS coordinator and slaves are done"
