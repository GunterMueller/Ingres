#!/bin/bash
#
# Copyright (c) 2004 Ingres Corporation
#
# Copy all deliverable vec files from $ING_SRC to $ING_BUILD.
#
# This script is a temporary cludge until somebody writes the MING file
# to do this correctly.
#
#

CMD=`basename $0`

# Check for required environmentals
: ${ING_SRC?"must be set"}
: ${ING_BUILD?"must be set"}

echo "Copying files from $ING_SRC/vec31/usr/vec to $ING_BUILD/vec ..."

# Make sure that install.dat does not interfere
[ -f $II_SYSTEM/ingres/files/install.dat ] &&
{
	cd $II_SYSTEM/ingres/files
	mv install.dat install.dat.$$
}

# Find files
FILES=`iimaninf -resolve=vigraph | grep ingres/vec | \
       awk '{ print $1,$2 ; }' | sed -e "s:^ingres/::" -e "s: :/:"`

[ -f $II_SYSTEM/ingres/files/install.dat.$$ ] && mv install.dat.$$ install.dat

# Copy files
echo $FILES | tr ' ' '\012' | \
( cd $ING_SRC/vec31/usr; gtar cTfb - - 8 ) | ( cd $ING_BUILD; gtar xpfb - 8 )

# Set permissions for files
cd $ING_BUILD/vec
find . -type f -exec chmod 644 {} ';'

echo "$CMD done."
exit 0
