#!/bin/bash
#  Copyright (c) 2004 Ingres Corporation	
#  Name: iisutm	
#
#  Usage:
#	iisutm
#
#  Description:
#	Setup program for terminal monitors called by the installation
#	utility.
#
#  Exit Status:
#	0	setup successful	
#	1	setup failed.	
#
#  PROGRAM = iisutm
#
#  DEST = utility
#--------------------------------------------------------------------------

if [ "$1" = "-rmpkg" ] ; then
   cat << !
  Terminal Monitor utility files have been removed

!
exit 0
fi

WRITE_RESPONSE=false
READ_RESPONSE=false
RESOUTFILE=ingrsp.rsp
RESINFILE=ingrsp.rsp

# check for batch flag
if [ "$1" = "-batch" ] ; then
   BATCH=true
   NOTBATCH=false
   INSTLOG="2>&1 | cat >> $II_SYSTEM/ingres/files/install.log"
elif [ "$1" = "-vbatch" ] ; then
   BATCH=true
   NOTBATCH=false
   INSTLOG="2>&1 | tee -a $II_SYSTEM/ingres/files/install.log"
elif [ "$1" = "-mkresponse" ] ; then
   WRITE_RESPONSE=true
   BATCH=false
   NOTBATCH=true
   INSTLOG="2>&1 | tee -a $II_SYSTEM/ingres/files/install.log"
   if [ "$2" ] ; then
        RESOUTFILE="$2"
   fi
elif [ "$1" = "-exresponse" ] ; then
   READ_RESPONSE=true
   BATCH=true
   NOTBATCH=false
   INSTLOG="2>&1 | tee -a $II_SYSTEM/ingres/files/install.log"
   if [ "$2" ] ; then
        RESINFILE="$2"
   fi
else
   BATCH=false
   NOTBATCH=true
   INSTLOG="2>&1 | tee -a $II_SYSTEM/ingres/files/install.log"
fi

export BATCH
export INSTLOG
export WRITE_RESPONSE
export READ_RESPONSE

do_iisutm()
{
. iisysdep

. iishlib

check_response_file

#
# Install utility files: dayfile, startup.
#
 
echo "Installing Terminal Monitor utility files..."

exitstat=0

if [ "$WRITE_RESPONSE" = "true" ] ; then
        mkresponse_msg
else ## **** Skip everything if we are in WRITE_RESPONSE mode ****
 
cd $II_SYSTEM/ingres/files
 
#
# Save the old dayfile, and install the new one.
#
 
[ -r dayfile ] && {
    mv dayfile dayfile.old
    [ $? -eq 0 ] || exitstat=$?
}

cp dayfile.dst dayfile
[ $? -eq 0 ] || exitstat=$?

chmod 644 dayfile
[ $? -eq 0 ] || exitstat=$?
 
#
# quel and sql startup files
#

for file in startup startsql
do
    [ -f ${file}.dst -a ! -r $file ] && {
	cp ${file}.dst $file
	[ $? -eq 0 ] || exitstat=$?
	chmod 644 $file
	[ $? -eq 0 ] || exitstat=$?
    }
done
fi #end WRITE_RESPONSE mode

exit $exitstat
}
eval do_iisutm $INSTLOG
